<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Zachary's Snackery</title>
  <link rel="icon" href="zsnackery-logo.png" type="image/png">
  <link href="style.css" rel="stylesheet"/>
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body>
<section class="hero-fullscreen">
  <img alt="Zachary's Snackery Logo" class="fullscreen-logo" src="zsnackery-logo.png"/>
  <a href="#form-section" class="order-btn">Order Now</a>
  <div class="scroll-down">â–¼</div>
</section>
<main class="content">
  <section class="intro">
    <p>
      I grew up allergic to the baked goods everyone else could eat â€” dairy, nuts, and sesame were always off the table.
      Thatâ€™s why I started Zacharyâ€™s Snackery: a brand that brings bold, nostalgic flavors to everyone in an allergy-friendly way.
      Every baked good is made without dairy, nuts, or sesame â€” so no one has to miss out on the good stuff.
    </p>
  </section>
  <section class="products">
    <h2>Baked Goods</h2>
    <div class="card">
      <h3>Gingersnaps</h3>
      <p>Classic spice with a crisp snap and warm molasses finish â€” perfect with a cup of tea or just on their own.</p>
    </div>
    <div class="card">
      <h3>Chocolate Crinkle Cookies</h3>
      <p>Rich, fudgy chocolate cookies rolled in powdered sugar â€” cracked on the outside, soft on the inside.</p>
    </div>
    <div class="card">
      <h3>Snickerdoodles</h3>
      <p>Soft, cinnamon-sweet, and kissed with gentle salt â€” a timeless favorite with an allergy-friendly twist. Also really good with coffee.</p>
    </div>
  </section>
  <h2>How to Order</h2>
  <p>Personal orders with local delivery now available. Farmers Market booth coming soon!</p>
  <section class="order-expanded">
    <h2>
      <a href="#form-section" class="dropdown-toggle">ðŸ“¦ Place an Order</a>
    </h2>
  </section>

  <div id="form-section">
    <iframe frameborder="0" height="2170" marginheight="0" marginwidth="0"
            src="https://docs.google.com/forms/d/e/1FAIpQLSc99kqmjsNfMzCVRQDE_cm7lIpiOjMgutuYw3KTe0ppg3HJow/viewform?embedded=true"
            width="100%">Loadingâ€¦
    </iframe>
  </div>

  <!-- ===================== REVIEWS (Realtime via Firebase) ===================== -->
  <section class="reviews" id="reviews">
    <h2>Customer Reviews</h2>

    <!-- List renders live here -->
    <div id="reviews-list" aria-live="polite"></div>

    <!-- Write a review -->
    <form id="review-form" class="review-form" autocomplete="off">
      <div class="stars" role="radiogroup" aria-label="Rating">
        <button type="button" data-star="1" aria-label="1 star">â˜…</button>
        <button type="button" data-star="2" aria-label="2 stars">â˜…</button>
        <button type="button" data-star="3" aria-label="3 stars">â˜…</button>
        <button type="button" data-star="4" aria-label="4 stars">â˜…</button>
        <button type="button" data-star="5" aria-label="5 stars">â˜…</button>
        <input type="hidden" name="rating" id="rating" value="5">
      </div>

      <input name="name" id="name" maxlength="40" placeholder="Your name" required />
      <textarea name="text" id="text" minlength="5" maxlength="500"
        placeholder="Share your experience (allergy-friendly wins, favorite cookie, etc.)" required></textarea>

      <button type="submit" class="order-btn">Post Review</button>
      <small id="review-status" class="review-status"></small>
    </form>
  </section>

  <!-- Firebase SDKs -->
  <script type="module">
  // --- Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyBcG04pspfGCJL_uFON8AZKeu-GtGjap9g",
    authDomain: "zachary-s-snackery.firebaseapp.com",
    projectId: "zachary-s-snackery",
    storageBucket: "zachary-s-snackery.firebasestorage.app",
    messagingSenderId: "240859823237",
    appId: "1:240859823237:web:f1608d6ba3d9ef05bf7dec"
  };

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import {
    getFirestore, collection, addDoc, serverTimestamp,
    query, orderBy, limit, onSnapshot
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const col = collection(db, "reviews");

  // DOM elements
  const el = (tag, cls) => { const n = document.createElement(tag); if (cls) n.className = cls; return n; };
  const list = document.getElementById("reviews-list");
  const form = document.getElementById("review-form");
  const nameInput = document.getElementById("name");
  const textInput = document.getElementById("text");
  const ratingInput = document.getElementById("rating");
  const statusEl = document.getElementById("review-status");

  // Cooldown (30 s)
  const canPost = () => {
    const last = parseInt(localStorage.getItem("zsnackery_last_post") || "0", 10);
    return (Date.now() - last) > 30000;
  };
  const stampPost = () => localStorage.setItem("zsnackery_last_post", String(Date.now()));

  // Stars
  const starButtons = Array.from(document.querySelectorAll(".stars [data-star]"));
  function setStars(n) {
    ratingInput.value = n;
    starButtons.forEach(btn => {
      btn.classList.toggle("active", Number(btn.dataset.star) <= n);
    });
  }
  starButtons.forEach(btn => btn.addEventListener("click", () => setStars(Number(btn.dataset.star))));
  setStars(5);

  // --- PROFANITY & RACISM FILTER (client side) ---
  const bannedWords = [
    'fuck','shit','bitch','asshole','bastard','cunt','dick','pussy','slut','whore',
    'retard','spaz','cracker','nigger','chink','spic','wetback','fag','dyke','coon',
    'gook','tranny','terrorist','isis','kkk'
  ];

  function containsBadWords(str) {
    const lower = str.toLowerCase();
    return bannedWords.some(w => lower.includes(w));
  }

  // --- Render reviews ---
  function renderReview({ name, text, rating, createdAt }) {
    const card = el("div", "review");
    const head = el("div", "review-head");
    const stars = el("span", "review-stars");
    stars.textContent = "â˜…".repeat(rating || 5);
    const who = el("strong"); who.textContent = name || "Anonymous";
    const when = el("span", "review-date");
    if (createdAt?.toDate) {
      const d = createdAt.toDate();
      when.textContent = " Â· " + d.toLocaleDateString();
    }
    head.append(stars, who, when);
    const body = el("p"); body.textContent = text;
    card.append(head, body);
    return card;
  }

  // --- Live listener ---
  const q = query(col, orderBy("createdAt", "desc"), limit(50));
  onSnapshot(q, (snap) => {
    list.innerHTML = "";
    snap.forEach(doc => list.appendChild(renderReview(doc.data())));
  });

  // --- Submit ---
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = nameInput.value.trim();
    const text = textInput.value.trim();
    const rating = Number(ratingInput.value || 5);

    // profanity / racism check
    if (containsBadWords(name) || containsBadWords(text)) {
      statusEl.textContent = "Please remove inappropriate or discriminatory words before posting.";
      return;
    }

    if (!canPost()) {
      statusEl.textContent = "Please wait a bit before posting again ðŸ˜Š";
      return;
    }

    if (text.length < 5) {
      statusEl.textContent = "Review is too short.";
      return;
    }

    try {
      await addDoc(col, { name, text, rating, createdAt: serverTimestamp() });
      form.reset(); setStars(5); stampPost();
      statusEl.textContent = "Thanks! Your review is live.";
    } catch (err) {
      console.error(err);
      statusEl.textContent = "Couldnâ€™t post right now. Try again soon.";
    }
  });
</script>

</main>
<footer>
  <p>ðŸ“¸ Follow us on Instagram: <a href="https://instagram.com/zacharyssnackery" target="_blank">@zacharyssnackery</a></p>
  <p class="copyright">Â© 2025 Zacharyâ€™s Snackery</p>
  <p class="cottage-note">
    <small>Zacharyâ€™s Snackery operates under Floridaâ€™s Cottage Food Law. Products are made in a home kitchen not inspected by the Department of Agriculture.</small>
  </p>
</footer>
</body>
</html>
